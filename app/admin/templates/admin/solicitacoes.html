{% extends 'base.html' %}
{% block content %}
<div class="mb-6"><h2 class="text-2xl font-bold text-slate-800">Solicitações</h2></div>

<div class="mb-6"><input type="text" id="buscaSolic" onkeyup="filtrarSolic('buscaSolic', 'gridSolic')" placeholder="Pesquisar por nome..." class="w-full p-4 rounded-xl border border-slate-200 shadow-sm"></div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="gridSolic">
    {% for s in solicitacoes %}
    <div class="bg-white border border-slate-200 rounded-xl p-6 shadow-sm relative border-l-4 {% if s.tipo_solicitacao == 'Exclusao' %} border-l-red-500 {% elif s.tipo_solicitacao == 'Inclusao' %} border-l-emerald-500 {% else %} border-l-blue-500 {% endif %} item-solic">
        <span class="absolute top-4 right-4 bg-yellow-100 text-yellow-700 text-[10px] font-bold px-2 py-1 rounded uppercase">{{ s.tipo_solicitacao }}</span>
        <div class="flex items-center gap-3 mb-4">
            <div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center font-bold text-slate-600">{{ s.user.real_name[:2].upper() }}</div>
            <div><h3 class="font-bold text-slate-800 text-sm nome-solic">{{ s.user.real_name }}</h3><p class="text-xs text-slate-500">Ref: {{ s.data_referencia.strftime('%d/%m/%Y') }}</p></div>
        </div>
        <div class="bg-slate-50 p-3 rounded-lg mb-4 text-sm">
            {% if s.tipo_solicitacao == 'Edicao' %}
                <div class="flex justify-between mb-1 text-xs"><span class="text-slate-400">De:</span> <span class="font-mono text-slate-600 line-through">{{ extras[s.id] }}</span></div>
                <div class="flex justify-between mb-1 text-sm font-bold"><span class="text-slate-600">Para:</span> <span class="font-mono text-blue-600">{{ s.novo_horario }} ({{ s.tipo_batida }})</span></div>
            {% elif s.tipo_solicitacao == 'Exclusao' %}
                <div class="text-red-600 font-bold text-center py-2">SOLICITA REMOÇÃO</div><div class="text-center text-xs text-slate-500">Alvo: {{ extras[s.id] }}</div>
            {% else %}
                <div class="text-emerald-600 font-bold text-center py-2">NOVA MARCAÇÃO</div><div class="text-center font-mono">{{ s.novo_horario }} ({{ s.tipo_batida }})</div>
            {% endif %}
            <div class="mt-3 text-xs text-slate-600 italic border-t pt-2">"{{ s.justificativa }}"</div>
        </div>
        <form action="/admin/solicitacoes" method="POST" class="flex flex-col gap-2">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <input type="hidden" name="solic_id" value="{{ s.id }}">
            <div class="flex gap-2">
                <button type="submit" name="decisao" value="aprovar" class="flex-1 bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 rounded text-xs transition">APROVAR</button>
                <button type="button" onclick="document.getElementById('repro-{{ s.id }}').classList.remove('hidden')" class="flex-1 bg-red-100 hover:bg-red-200 text-red-600 font-bold py-2 rounded text-xs transition">REPROVAR</button>
            </div>
            <div id="repro-{{ s.id }}" class="hidden mt-2"><input type="text" name="motivo_repro" class="w-full border border-red-200 rounded p-2 text-xs mb-2 bg-red-50" placeholder="Motivo..."><button type="submit" name="decisao" value="reprovar" class="w-full bg-red-600 text-white font-bold py-2 rounded text-xs">ENVIAR</button></div>
        </form>
    </div>
    {% else %}<div class="col-span-2 text-center py-12 text-slate-400 bg-white rounded-xl border border-slate-200 border-dashed"><p>Nenhuma solicitação pendente.</p></div>{% endfor %}
</div>
<script>
function filtrarSolic(inputId, gridId) {
    let input = document.getElementById(inputId);
    let filter = input.value.toUpperCase();
    let grid = document.getElementById(gridId);
    let itens = grid.getElementsByClassName('item-solic');
    for (let i = 0; i < itens.length; i++) {
        let nome = itens[i].getElementsByClassName('nome-solic')[0];
        if (nome.innerHTML.toUpperCase().indexOf(filter) > -1) { itens[i].style.display = ""; } else { itens[i].style.display = "none"; }
    }
}
</script>
{% endblock %}